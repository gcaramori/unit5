import nodemailer, { Transporter } from 'nodemailer'

interface EmailMessage {
  from: string
  to: string
  subject: string
  text?: string
  html?: string
}

export async function POST(request: Request) {
  const data = await request.json()

  const transporter: Transporter = nodemailer.createTransport({
    host: 'email-smtp.us-east-2.amazonaws.com',
    port: 2587,
    secure: false,
    auth: {
      user: process.env.EMAIL_USER,
      pass: process.env.EMAIL_PASSWORD,
    },
    tls: {
      ciphers: 'SSLv3',
    },
  })

  const message: EmailMessage = {
    from: data.email,
    to: 'gcaramori16@gmail.com',
    subject: 'New prospected customer!',
    html: `
      <!doctypehtml><html xmlns=http://www.w3.org/1999/xhtml xmlns:o=urn:schemas-microsoft-com:office:office xmlns:v=urn:schemas-microsoft-com:vml><title></title><!--[if !mso]><!-- --><meta content="IE=edge"http-equiv=X-UA-Compatible><!--<![endif]--><meta content="text/html; charset=UTF-8"http-equiv=Content-Type><meta content="width=device-width,initial-scale=1"name=viewport><style>#outlook a{padding:0}.ReadMsgBody{width:100%}.ExternalClass{width:100%}.ExternalClass *{line-height:100%}body{margin:0;padding:0;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}table,td{border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0}img{border:0;height:auto;line-height:100%;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic}p{display:block;margin:13px 0}</style><!--[if !mso]><!--><style>@media only screen and (max-width:480px){@-ms-viewport{width:320px}@viewport{width:320px}}</style><!--<![endif]--><!--[if mso]><xml><o:officedocumentsettings><o:allowpng><o:pixelsperinch>96</o:pixelsperinch></o:officedocumentsettings></xml><![endif]--><!--[if lte mso 11]><style>.outlook-group-fix{width:100%!important}</style><![endif]--><!--[if !mso]><!--><link href="https://fonts.googleapis.com/css?family=Lato:300,400,500,700"rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700"rel=stylesheet><style>@import url(https://fonts.googleapis.com/css?family=Lato:300,400,500,700);@import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);</style><!--<![endif]--><style>@media only screen and (min-width:480px){.mj-column-per-100{width:100%!important;max-width:100%}}</style><style>@media only screen and (max-width:480px){table.full-width-mobile{width:100%!important}td.full-width-mobile{width:auto!important}}</style><body style=background-color:#e0f2ff><div style=background-color:#e0f2ff><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 width=600 style=width:600px align=center><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#222;background-color:#222;Margin:0 auto;max-width:600px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#222;background-color:#222;width:100% align=center><tr><td style="direction:ltr;font-size:0;padding:10px 0;text-align:center;vertical-align:top"><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:600px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style=vertical-align:top;padding:0><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style="font-size:0;padding:10px 0;word-break:break-word"align=center><table border=0 cellpadding=0 cellspacing=0 role=presentation style=border-collapse:collapse;border-spacing:0><tr><td style=width:150px><img alt=logo height=auto src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihYSvXmT3grmxrTPr0qRu2ltxPxyizr-mznkM2mszwsxTM2Twh1IoBRYyO9IGTC7qqb6JCh5k8wsnMvVItGdfWdz-BodkYbhjNc=w1910-h885"style=border:0;display:block;outline:0;text-decoration:none;height:auto;width:100% width=150></table></table></table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 width=600 style=width:600px align=center><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#fff;background-color:#fff;Margin:0 auto;max-width:600px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#fff;background-color:#fff;width:100% align=center><tr><td style=direction:ltr;font-size:0;padding:0;padding-top:20px;text-align:center;vertical-align:top><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:600px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style=vertical-align:top;padding:0><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=center><table border=0 cellpadding=0 cellspacing=0 role=presentation style=border-collapse:collapse;border-spacing:0><tr><td style=width:192px><img alt=yay height=auto src="https://lh3.google.com/u/0/d/1GmjE4opKQk7AXyVLnlgVfEuofSfmdfdS=w1910-h885-iv1"style=border:0;display:block;outline:0;text-decoration:none;height:auto;width:100% width=192></table><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=center><div style=font-family:Lato,Helvetica,Arial,sans-serif;font-size:25px;line-height:1;text-align:center;color:#fab701><strong>New Customer Prospected!</strong></div></table></table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 width=600 style=width:600px align=center><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#fff;background-color:#fff;Margin:0 auto;max-width:600px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#fff;background-color:#fff;width:100% align=center><tr><td style="direction:ltr;font-size:0;padding:50px 0;text-align:center;vertical-align:top"><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:600px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style=vertical-align:top;padding:0><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=center><div style=font-family:Lato,Helvetica,Arial,sans-serif;font-size:23px;line-height:1;text-align:center;color:#fab701><strong>His/her informations:</strong></div></table></table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 width=600 style=width:600px align=center><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#fff;background-color:#fff;Margin:0 auto;max-width:600px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#fff;background-color:#fff;width:100% align=center><tr><td style="direction:ltr;font-size:0;padding:0 0 30px 0;text-align:center;vertical-align:top"><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:600px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style=vertical-align:top;padding:0><table border=0 cellpadding=0 cellspacing=0 role=presentation width=100%><tr><td style=font-size:0;padding:0;word-break:break-word align=left><table border=0 cellpadding=0 cellspacing=0 width=100% style=cellspacing:0;color:#000;font-family:Ubuntu,Helvetica,Arial,sans-serif;font-size:13px;line-height:22px;table-layout:auto;width:100%><tr style="border-bottom:1px solid #ecedee;text-align:left;padding:15px 0"><th style="padding:0 15px 0 0;font-size:16px;font-family:Lato,sans-serif;font-weight:700;text-align:center">Name<th style="padding:0 15px 0 0;font-size:16px;font-family:Lato,sans-serif;font-weight:700;text-align:center">Email<th style="padding:0 15px 0 0;font-size:16px;font-family:Lato,sans-serif;font-weight:700;text-align:center">Phone Number<tr><td style="padding:0 15px 0 0;font-size:15px;font-family:Lato,sans-serif;font-weight:700;text-align:center">${data.name}<td style="padding:0 15px 0 0;font-size:15px;font-family:Lato,sans-serif;font-weight:700;text-align:center">${data.email}<td style="padding:0 15px 0 0;font-size:15px;font-family:Lato,sans-serif;font-weight:700;text-align:center">${data.phone}</table></table></table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><![endif]--></div>
    `,
  }

  try {
    const sendedEmail = await transporter.sendMail(message)

    return Response.json({ sendedEmail, success: true })
  } catch (error) {
    return Response.json({ error, success: false })
  }
}
